# ä¸‰Agent Framework é¡¹ç›®ç»“æ„å’Œé…ç½®ç¤ºä¾‹

## 1. å®Œæ•´é¡¹ç›®ç›®å½•ç»“æ„

```
building-area-framework/
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”‚
â”œâ”€â”€ backend/                          # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                       # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py                     # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ database.py                   # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ models/                       # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ project.py
â”‚   â”‚   â”œâ”€â”€ workflow.py
â”‚   â”‚   â””â”€â”€ results.py
â”‚   â”œâ”€â”€ api/                          # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ projects.py
â”‚   â”‚   â”œâ”€â”€ files.py
â”‚   â”‚   â”œâ”€â”€ workflow.py
â”‚   â”‚   â””â”€â”€ results.py
â”‚   â”œâ”€â”€ core/                         # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ workflow_engine.py
â”‚   â”‚   â”œâ”€â”€ base_agent.py
â”‚   â”‚   â””â”€â”€ file_manager.py
â”‚   â”œâ”€â”€ agents/                       # ä¸‰ä¸ªAgentå®ç°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ regulation_agent/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ agent.py
â”‚   â”‚   â”‚   â”œâ”€â”€ pdf_parser.py
â”‚   â”‚   â”‚   â””â”€â”€ rule_extractor.py
â”‚   â”‚   â”œâ”€â”€ alignment_agent/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ agent.py
â”‚   â”‚   â”‚   â”œâ”€â”€ ifc_loader.py
â”‚   â”‚   â”‚   â”œâ”€â”€ semantic_matcher.py
â”‚   â”‚   â”‚   â””â”€â”€ confidence_evaluator.py
â”‚   â”‚   â””â”€â”€ area_agent/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ agent.py
â”‚   â”‚       â”œâ”€â”€ calculator.py
â”‚   â”‚       â””â”€â”€ report_generator.py
â”‚   â”œâ”€â”€ utils/                        # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ file_utils.py
â”‚   â”‚   â”œâ”€â”€ validation.py
â”‚   â”‚   â””â”€â”€ logging_config.py
â”‚   â””â”€â”€ tests/                        # æµ‹è¯•æ–‡ä»¶
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ test_agents.py
â”‚       â”œâ”€â”€ test_workflow.py
â”‚       â””â”€â”€ test_api.py
â”‚
â”œâ”€â”€ frontend/                         # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â””â”€â”€ favicon.ico
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ index.tsx
â”‚       â”œâ”€â”€ App.tsx
â”‚       â”œâ”€â”€ components/               # Reactç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ common/
â”‚       â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚       â”‚   â”‚   â””â”€â”€ LoadingSpinner.tsx
â”‚       â”‚   â”œâ”€â”€ workflow/
â”‚       â”‚   â”‚   â”œâ”€â”€ WorkflowManager.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ StageIndicator.tsx
â”‚       â”‚   â”‚   â””â”€â”€ ProgressBar.tsx
â”‚       â”‚   â”œâ”€â”€ stages/
â”‚       â”‚   â”‚   â”œâ”€â”€ RegulationStage.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ AlignmentStage.tsx
â”‚       â”‚   â”‚   â””â”€â”€ CalculationStage.tsx
â”‚       â”‚   â””â”€â”€ results/
â”‚       â”‚       â”œâ”€â”€ ResultsViewer.tsx
â”‚       â”‚       â”œâ”€â”€ ReportGenerator.tsx
â”‚       â”‚       â””â”€â”€ DataVisualization.tsx
â”‚       â”œâ”€â”€ services/                 # APIæœåŠ¡
â”‚       â”‚   â”œâ”€â”€ api.ts
â”‚       â”‚   â”œâ”€â”€ websocket.ts
â”‚       â”‚   â””â”€â”€ file-upload.ts
â”‚       â”œâ”€â”€ hooks/                    # React Hooks
â”‚       â”‚   â”œâ”€â”€ useWorkflow.ts
â”‚       â”‚   â”œâ”€â”€ useWebSocket.ts
â”‚       â”‚   â””â”€â”€ useFileUpload.ts
â”‚       â”œâ”€â”€ types/                    # TypeScriptç±»å‹å®šä¹‰
â”‚       â”‚   â”œâ”€â”€ project.ts
â”‚       â”‚   â”œâ”€â”€ workflow.ts
â”‚       â”‚   â””â”€â”€ results.ts
â”‚       â”œâ”€â”€ utils/
â”‚       â”‚   â”œâ”€â”€ constants.ts
â”‚       â”‚   â”œâ”€â”€ helpers.ts
â”‚       â”‚   â””â”€â”€ validation.ts
â”‚       â””â”€â”€ styles/
â”‚           â”œâ”€â”€ globals.css
â”‚           â””â”€â”€ components.css
â”‚
â”œâ”€â”€ docs/                             # æ–‡æ¡£
â”‚   â”œâ”€â”€ api-reference.md
â”‚   â”œâ”€â”€ user-guide.md
â”‚   â”œâ”€â”€ deployment.md
â”‚   â””â”€â”€ architecture.md
â”‚
â”œâ”€â”€ scripts/                          # éƒ¨ç½²å’Œç»´æŠ¤è„šæœ¬
â”‚   â”œâ”€â”€ setup.sh
â”‚   â”œâ”€â”€ deploy.sh
â”‚   â””â”€â”€ backup.sh
â”‚
â”œâ”€â”€ config/                           # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ nginx.conf
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ Dockerfile.backend
â”‚   â”‚   â””â”€â”€ Dockerfile.frontend
â”‚   â””â”€â”€ k8s/                         # Kubernetesé…ç½®
â”‚       â”œâ”€â”€ deployment.yaml
â”‚       â”œâ”€â”€ service.yaml
â”‚       â””â”€â”€ ingress.yaml
â”‚
â””â”€â”€ data/                            # æ•°æ®æ–‡ä»¶
    â”œâ”€â”€ samples/                     # ç¤ºä¾‹æ–‡ä»¶
    â”‚   â”œâ”€â”€ regulations/
    â”‚   â””â”€â”€ ifc/
    â””â”€â”€ uploads/                     # ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
        â”œâ”€â”€ regulations/
        â””â”€â”€ ifc/
```

## 2. æ ¸å¿ƒé…ç½®æ–‡ä»¶

### 2.1 åç«¯é…ç½® (backend/config.py)

```python
from pydantic import BaseSettings
from typing import Optional
import os

class Settings(BaseSettings):
    # åº”ç”¨é…ç½®
    app_name: str = "Building Area Calculation Framework"
    app_version: str = "1.0.0"
    debug: bool = False
    
    # æ•°æ®åº“é…ç½®
    database_url: str = "postgresql://user:password@localhost:5432/building_area"
    
    # Redisé…ç½®
    redis_url: str = "redis://localhost:6379"
    
    # OpenAIé…ç½®
    openai_api_key: str
    openai_model: str = "gpt-4"
    openai_max_tokens: int = 4000
    
    # æ–‡ä»¶å­˜å‚¨é…ç½®
    upload_dir: str = "./uploads"
    max_file_size: int = 100 * 1024 * 1024  # 100MB
    allowed_extensions: list = [".pdf", ".ifc", ".json"]
    
    # å·¥ä½œæµé…ç½®
    max_concurrent_projects: int = 10
    workflow_timeout: int = 3600  # 1å°æ—¶
    
    # æ—¥å¿—é…ç½®
    log_level: str = "INFO"
    log_file: str = "app.log"
    
    # å®‰å…¨é…ç½®
    secret_key: str
    access_token_expire_minutes: int = 30
    
    class Config:
        env_file = ".env"
        case_sensitive = False

settings = Settings()
```

### 2.2 ç¯å¢ƒå˜é‡é…ç½® (.env.example)

```bash
# åº”ç”¨é…ç½®
APP_NAME="Building Area Calculation Framework"
DEBUG=false

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://user:password@localhost:5432/building_area
POSTGRES_DB=building_area
POSTGRES_USER=user
POSTGRES_PASSWORD=password

# Redisé…ç½®
REDIS_URL=redis://localhost:6379

# OpenAIé…ç½®
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4
OPENAI_MAX_TOKENS=4000

# æ–‡ä»¶å­˜å‚¨é…ç½®
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=104857600  # 100MB

# å®‰å…¨é…ç½®
SECRET_KEY=your_secret_key_here
ACCESS_TOKEN_EXPIRE_MINUTES=30

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=app.log

# å·¥ä½œæµé…ç½®
MAX_CONCURRENT_PROJECTS=10
WORKFLOW_TIMEOUT=3600
```

### 2.3 ä¾èµ–ç®¡ç† (requirements.txt)

```txt
# Webæ¡†æ¶
fastapi==0.104.1
uvicorn[standard]==0.24.0
starlette==0.27.0

# æ•°æ®åº“
sqlalchemy==2.0.23
psycopg2-binary==2.9.9
alembic==1.12.1

# ç¼“å­˜
redis==5.0.1

# LLMå’ŒAI
openai==1.3.5
langchain==0.0.340
langchain-openai==0.0.2

# IFCå¤„ç†
ifcopenshell==0.7.0

# PDFå¤„ç†
PyPDF2==3.0.1
pdfplumber==0.10.3

# æ•°æ®å¤„ç†
pandas==2.1.3
numpy==1.25.2
pydantic==2.5.0

# æ–‡ä»¶å¤„ç†
python-multipart==0.0.6
aiofiles==23.2.1

# å¼‚æ­¥å¤„ç†
celery==5.3.4

# ç›‘æ§å’Œæ—¥å¿—
prometheus-client==0.19.0
structlog==23.2.0

# æµ‹è¯•
pytest==7.4.3
pytest-asyncio==0.21.1
httpx==0.25.2

# å¼€å‘å·¥å…·
black==23.11.0
flake8==6.1.0
mypy==1.7.1
```

### 2.4 å‰ç«¯é…ç½® (frontend/package.json)

```json
{
  "name": "building-area-frontend",
  "version": "1.0.0",
  "private": true,
  "dependencies": {
    "@types/node": "^20.9.0",
    "@types/react": "^18.2.37",
    "@types/react-dom": "^18.2.15",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.18.0",
    "react-scripts": "5.0.1",
    "typescript": "^5.2.2",
    "axios": "^1.6.0",
    "@tanstack/react-query": "^5.8.4",
    "@headlessui/react": "^1.7.17",
    "@heroicons/react": "^2.0.18",
    "tailwindcss": "^3.3.5",
    "recharts": "^2.8.0",
    "react-dropzone": "^14.2.3",
    "react-hot-toast": "^2.4.1",
    "zustand": "^4.4.6"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject",
    "lint": "eslint src --ext .ts,.tsx",
    "format": "prettier --write src/**/*.{ts,tsx}"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.11.0",
    "@typescript-eslint/parser": "^6.11.0",
    "eslint": "^8.53.0",
    "eslint-plugin-react": "^7.33.2",
    "prettier": "^3.1.0",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.31"
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}
```

### 2.5 Dockeré…ç½® (docker-compose.yml)

```yaml
version: '3.8'

services:
  # åç«¯æœåŠ¡
  backend:
    build:
      context: .
      dockerfile: config/docker/Dockerfile.backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/building_area
      - REDIS_URL=redis://redis:6379
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - SECRET_KEY=${SECRET_KEY}
    depends_on:
      - postgres
      - redis
    volumes:
      - ./data/uploads:/app/uploads
      - ./logs:/app/logs
    networks:
      - app-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # å‰ç«¯æœåŠ¡
  frontend:
    build:
      context: ./frontend
      dockerfile: ../config/docker/Dockerfile.frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    networks:
      - app-network
    restart: unless-stopped

  # æ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=building_area
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./config/postgres/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    networks:
      - app-network
    restart: unless-stopped

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
    ports:
      - "6379:6379"
    networks:
      - app-network
    restart: unless-stopped

  # Nginxåå‘ä»£ç†
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./config/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./config/ssl:/etc/nginx/ssl:ro
    depends_on:
      - frontend
      - backend
    networks:
      - app-network
    restart: unless-stopped

  # ç›‘æ§æœåŠ¡
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./config/prometheus.yml:/etc/prometheus/prometheus.yml:ro
    networks:
      - app-network
    restart: unless-stopped

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3001:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana_data:/var/lib/grafana
    networks:
      - app-network
    restart: unless-stopped

volumes:
  postgres_data:
  redis_data:
  grafana_data:

networks:
  app-network:
    driver: bridge
```

### 2.6 Nginxé…ç½® (config/nginx.conf)

```nginx
events {
    worker_connections 1024;
}

http {
    upstream backend {
        server backend:8000;
    }
    
    upstream frontend {
        server frontend:80;
    }
    
    # é™åˆ¶è¯·æ±‚å¤§å°
    client_max_body_size 100M;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
    
    # ä¸»æœåŠ¡å™¨é…ç½®
    server {
        listen 80;
        server_name localhost;
        
        # å‰ç«¯é™æ€æ–‡ä»¶
        location / {
            proxy_pass http://frontend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        # APIè¯·æ±‚
        location /api/ {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # æ”¯æŒé•¿æ—¶é—´è¯·æ±‚
            proxy_read_timeout 300s;
            proxy_connect_timeout 75s;
        }
        
        # WebSocketæ”¯æŒ
        location /ws/ {
            proxy_pass http://backend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        # å¥åº·æ£€æŸ¥
        location /health {
            proxy_pass http://backend/health;
        }
    }
}
```

## 3. éƒ¨ç½²è„šæœ¬

### 3.1 è®¾ç½®è„šæœ¬ (scripts/setup.sh)

```bash
#!/bin/bash

# è®¾ç½®è„šæœ¬
set -e

echo "ğŸš€ å¼€å§‹è®¾ç½®Building Area Framework..."

# æ£€æŸ¥Dockeræ˜¯å¦å®‰è£…
if ! command -v docker &> /dev/null; then
    echo "âŒ Dockeræœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker"
    exit 1
fi

if ! command -v docker-compose &> /dev/null; then
    echo "âŒ Docker Composeæœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…Docker Compose"
    exit 1
fi

# åˆ›å»ºå¿…è¦çš„ç›®å½•
echo "ğŸ“ åˆ›å»ºç›®å½•ç»“æ„..."
mkdir -p data/uploads/regulations
mkdir -p data/uploads/ifc
mkdir -p data/samples/regulations
mkdir -p data/samples/ifc
mkdir -p logs
mkdir -p config/ssl

# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
if [ ! -f .env ]; then
    echo "ğŸ“ åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶..."
    cp .env.example .env
    echo "âš ï¸  è¯·ç¼–è¾‘.envæ–‡ä»¶ï¼Œè®¾ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼ˆç‰¹åˆ«æ˜¯OPENAI_API_KEYå’ŒSECRET_KEYï¼‰"
fi

# ç”ŸæˆSSLè¯ä¹¦ï¼ˆç”¨äºå¼€å‘ï¼‰
if [ ! -f config/ssl/cert.pem ]; then
    echo "ğŸ” ç”Ÿæˆå¼€å‘ç”¨SSLè¯ä¹¦..."
    openssl req -x509 -newkey rsa:4096 -keyout config/ssl/key.pem -out config/ssl/cert.pem -days 365 -nodes -subj "/C=US/ST=State/L=City/O=Organization/CN=localhost"
fi

# è®¾ç½®æƒé™
echo "ğŸ”§ è®¾ç½®æ–‡ä»¶æƒé™..."
chmod +x scripts/*.sh
chmod 600 config/ssl/key.pem

# æ„å»ºå’Œå¯åŠ¨æœåŠ¡
echo "ğŸ—ï¸  æ„å»ºDockeré•œåƒ..."
docker-compose build

echo "ğŸš€ å¯åŠ¨æœåŠ¡..."
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 30

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "ğŸ” æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
docker-compose ps

# è¿è¡Œæ•°æ®åº“è¿ç§»
echo "ğŸ—„ï¸  è¿è¡Œæ•°æ®åº“è¿ç§»..."
docker-compose exec backend alembic upgrade head

echo "âœ… è®¾ç½®å®Œæˆï¼"
echo "ğŸŒ å‰ç«¯åœ°å€: http://localhost:3000"
echo "ğŸ”§ APIåœ°å€: http://localhost:8000"
echo "ğŸ“Š ç›‘æ§åœ°å€: http://localhost:3001 (Grafana, admin/admin)"
echo "ğŸ“ˆ æŒ‡æ ‡åœ°å€: http://localhost:9090 (Prometheus)"
```

### 3.2 éƒ¨ç½²è„šæœ¬ (scripts/deploy.sh)

```bash
#!/bin/bash

# ç”Ÿäº§éƒ¨ç½²è„šæœ¬
set -e

ENVIRONMENT=${1:-production}
echo "ğŸš€ å¼€å§‹éƒ¨ç½²åˆ° $ENVIRONMENT ç¯å¢ƒ..."

# æ£€æŸ¥ç¯å¢ƒå˜é‡
if [ -z "$OPENAI_API_KEY" ]; then
    echo "âŒ OPENAI_API_KEYç¯å¢ƒå˜é‡æœªè®¾ç½®"
    exit 1
fi

if [ -z "$SECRET_KEY" ]; then
    echo "âŒ SECRET_KEYç¯å¢ƒå˜é‡æœªè®¾ç½®"
    exit 1
fi

# æ‹‰å–æœ€æ–°ä»£ç 
echo "ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ..."
git pull origin main

# æ„å»ºæ–°é•œåƒ
echo "ğŸ—ï¸  æ„å»ºDockeré•œåƒ..."
docker-compose -f docker-compose.yml -f docker-compose.prod.yml build

# å¤‡ä»½æ•°æ®åº“
echo "ğŸ’¾ å¤‡ä»½æ•°æ®åº“..."
./scripts/backup.sh

# åœæ­¢æ—§æœåŠ¡
echo "ğŸ›‘ åœæ­¢æ—§æœåŠ¡..."
docker-compose down

# å¯åŠ¨æ–°æœåŠ¡
echo "ğŸš€ å¯åŠ¨æ–°æœåŠ¡..."
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 60

# è¿è¡Œæ•°æ®åº“è¿ç§»
echo "ğŸ—„ï¸  è¿è¡Œæ•°æ®åº“è¿ç§»..."
docker-compose exec backend alembic upgrade head

# å¥åº·æ£€æŸ¥
echo "ğŸ” æ‰§è¡Œå¥åº·æ£€æŸ¥..."
for i in {1..10}; do
    if curl -f http://localhost/health; then
        echo "âœ… æœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡"
        break
    else
        echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨... ($i/10)"
        sleep 10
    fi
done

# æ¸…ç†æ—§é•œåƒ
echo "ğŸ§¹ æ¸…ç†æ—§Dockeré•œåƒ..."
docker image prune -f

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
```

### 3.3 å¤‡ä»½è„šæœ¬ (scripts/backup.sh)

```bash
#!/bin/bash

# æ•°æ®å¤‡ä»½è„šæœ¬
set -e

BACKUP_DIR="./backups"
DATE=$(date +"%Y%m%d_%H%M%S")

echo "ğŸ’¾ å¼€å§‹æ•°æ®å¤‡ä»½..."

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
echo "ğŸ—„ï¸  å¤‡ä»½PostgreSQLæ•°æ®åº“..."
docker-compose exec -T postgres pg_dump -U user building_area > "$BACKUP_DIR/database_$DATE.sql"

# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
echo "ğŸ“ å¤‡ä»½ä¸Šä¼ æ–‡ä»¶..."
tar -czf "$BACKUP_DIR/uploads_$DATE.tar.gz" data/uploads/

# å¤‡ä»½é…ç½®æ–‡ä»¶
echo "âš™ï¸  å¤‡ä»½é…ç½®æ–‡ä»¶..."
tar -czf "$BACKUP_DIR/config_$DATE.tar.gz" .env config/

# æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘7å¤©ï¼‰
echo "ğŸ§¹ æ¸…ç†æ—§å¤‡ä»½æ–‡ä»¶..."
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "âœ… å¤‡ä»½å®Œæˆï¼"
echo "ğŸ“ å¤‡ä»½æ–‡ä»¶ä½ç½®: $BACKUP_DIR"
ls -la $BACKUP_DIR/*$DATE*
```

## 4. å¼€å‘å·¥å…·é…ç½®

### 4.1 Gité…ç½® (.gitignore)

```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# ç¯å¢ƒå˜é‡
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# æ•°æ®åº“
*.db
*.sqlite3

# æ—¥å¿—æ–‡ä»¶
*.log
logs/

# ä¸Šä¼ æ–‡ä»¶
data/uploads/

# å¤‡ä»½æ–‡ä»¶
backups/

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# Node.js
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# æ„å»ºè¾“å‡º
build/
dist/

# æµ‹è¯•è¦†ç›–ç‡
coverage/
.coverage
.pytest_cache/

# Docker
.dockerignore

# ä¸´æ—¶æ–‡ä»¶
*.tmp
*.temp
.DS_Store
Thumbs.db

# SSLè¯ä¹¦
config/ssl/*.pem
config/ssl/*.key
```

### 4.2 ä»£ç æ ¼å¼åŒ–é…ç½® (.pre-commit-config.yaml)

```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
      - id: check-json
      - id: pretty-format-json
        args: ['--autofix']

  - repo: https://github.com/psf/black
    rev: 23.11.0
    hooks:
      - id: black
        language_version: python3.11

  - repo: https://github.com/pycqa/flake8
    rev: 6.1.0
    hooks:
      - id: flake8
        args: [--max-line-length=88, --extend-ignore=E203,W503]

  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort
        args: [--profile=black]

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.7.1
    hooks:
      - id: mypy
        additional_dependencies: [types-all]
```

è¿™ä¸ªé¡¹ç›®ç»“æ„å’Œé…ç½®ç¤ºä¾‹æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ã€ç”Ÿäº§å°±ç»ªçš„ä¸‰Agent frameworkå®ç°æ–¹æ¡ˆï¼ŒåŒ…æ‹¬äº†è¯¦ç»†çš„ç›®å½•ç»“æ„ã€é…ç½®æ–‡ä»¶ã€éƒ¨ç½²è„šæœ¬å’Œå¼€å‘å·¥å…·é…ç½®ã€‚