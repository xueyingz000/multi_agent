# 三Agent联合建筑面积计算框架 - 用户操作流程模拟

## 框架概述

本框架由三个LLM Agent协同工作，完成建筑面积的智能计算：

1. **llm_regulation_agent** - 法规分析代理
2. **semantic_alignment_agent** - 语义对齐代理  
3. **building_area_agent** - 建筑面积计算代理

## 用户操作流程

### 阶段1：项目初始化和输入准备

#### 用户界面显示：
```
┌─────────────────────────────────────────────────────────────┐
│                建筑面积智能计算系统                           │
├─────────────────────────────────────────────────────────────┤
│ 步骤 1/3: 输入文件准备                                       │
│                                                             │
│ 📁 IFC文件上传:                                             │
│ [选择文件] endtoend.ifc                          ✓ 已上传    │
│                                                             │
│ 📋 法规文档上传:                                             │
│ [选择文件] china-area-calculation.pdf            ✓ 已上传    │
│ [选择文件] hk-area-calculation.pdf               ✓ 已上传    │
│ [选择文件] euro-area-calculation.pdf             ✓ 已上传    │
│                                                             │
│ 🏢 项目信息:                                                │
│ 建筑类型: [住宅建筑 ▼]                                       │
│ 地区标准: [中国大陆 ▼]                                       │
│ 项目名称: [输入项目名称]                                     │
│                                                             │
│                                    [开始分析] [重置]         │
└─────────────────────────────────────────────────────────────┘
```

#### 用户操作：
1. 上传IFC建筑模型文件
2. 上传相关地区的建筑面积计算法规文档（PDF格式）
3. 选择建筑类型和适用地区标准
4. 点击"开始分析"按钮

### 阶段2：Agent 1 - 法规分析处理

#### 用户界面显示：
```
┌─────────────────────────────────────────────────────────────┐
│                建筑面积智能计算系统                           │
├─────────────────────────────────────────────────────────────┤
│ 步骤 2/3: 法规分析中...                                      │
│                                                             │
│ 🤖 LLM法规分析代理 正在工作                                  │
│                                                             │
│ ✓ 正在解析法规文档...                              [████████] │
│ ✓ 提取层高相关规则...                              [████████] │
│ ✓ 分析覆盖/围护构件规则...                          [██████  ] │
│ ⏳ 处理特殊用途空间规则...                          [████    ] │
│                                                             │
│ 📊 当前进度: 75%                                            │
│ ⏱️  预计剩余时间: 30秒                                       │
│                                                             │
│ 📝 实时日志:                                                │
│ [14:23:15] 开始分析中国建筑面积计算规范...                    │
│ [14:23:18] 识别到层高阈值规则: >=2.2m 全计入                 │
│ [14:23:22] 提取阳台计算规则: 有围护结构按50%计入              │
│ [14:23:25] 分析地下室规则: 层高>2.2m全计入...                │
└─────────────────────────────────────────────────────────────┘
```

#### Agent 1 输出结果预览：
```
┌─────────────────────────────────────────────────────────────┐
│ 📋 法规分析结果                                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 1️⃣ 层高相关GFA计算规则:                                     │
│   • 层高 ≥ 2.2m: 全面积计入 (full)                          │
│   • 层高 < 2.2m: 按50%计入 (half)                           │
│   • 层高 < 1.2m: 不计入面积 (excluded)                      │
│                                                             │
│ 2️⃣ 覆盖/围护构件规则:                                       │
│   • 阳台(有围护): 按50%计入 (half)                          │
│   • 阳台(无围护): 不计入 (excluded)                         │
│   • 雨篷: 不计入 (excluded)                                 │
│   • 电梯井: 全面积计入 (full)                               │
│   • 楼梯间: 全面积计入 (full)                               │
│                                                             │
│ 3️⃣ 特殊用途空间规则:                                        │
│   • 地下车库: 层高>2.2m全计入 (full)                        │
│   • 设备用房: 全面积计入 (full)                             │
│   • 夹层: 按实际使用功能确定 (conditional)                   │
│                                                             │
│                                          [查看详细] [继续]   │
└─────────────────────────────────────────────────────────────┘
```

### 阶段3：Agent 2 - 语义对齐处理

#### 用户界面显示：
```
┌─────────────────────────────────────────────────────────────┐
│                建筑面积智能计算系统                           │
├─────────────────────────────────────────────────────────────┤
│ 步骤 3/3: 语义对齐分析中...                                  │
│                                                             │
│ 🤖 语义对齐代理 正在工作                                     │
│                                                             │
│ ✓ IFC模型解析完成                                [████████] │
│ ✓ 元素功能分类中...                              [██████  ] │
│ ⏳ 几何规范对齐中...                              [████    ] │
│ ⏳ 生成对齐报告...                                [██      ] │
│                                                             │
│ 📊 处理进度:                                                │
│ • 已处理IFC元素: 1,247 / 1,580                              │
│ • 高置信度对齐: 892 个                                      │
│ • 中等置信度: 284 个                                        │
│ • 需人工审查: 71 个                                         │
│                                                             │
│ 📝 实时分析:                                                │
│ [14:25:33] 识别楼板元素 GUID_001: 结构楼板 -> 全计入         │
│ [14:25:35] 识别空间元素 GUID_045: 阳台空间 -> 需进一步分析    │
│ [14:25:37] 几何分析: 层高2.8m -> 符合全计入条件              │
└─────────────────────────────────────────────────────────────┘
```

#### Agent 2 输出结果预览：
```
┌─────────────────────────────────────────────────────────────┐
│ 📊 语义对齐分析报告                                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 📈 对齐概要:                                                │
│ • 总处理元素: 1,580个                                       │
│ • 成功对齐: 1,509个 (95.5%)                                 │
│ • 需人工审查: 71个 (4.5%)                                   │
│                                                             │
│ 🎯 置信度分布:                                              │
│ • 高置信度 (>80%): 892个 (56.4%)                           │
│ • 中等置信度 (50-80%): 617个 (39.1%)                       │
│ • 低置信度 (<50%): 71个 (4.5%)                             │
│                                                             │
│ 📋 法规分类统计:                                            │
│ • 全面积计入: 1,156个                                       │
│ • 半面积计入: 234个                                         │
│ • 不计入面积: 119个                                         │
│                                                             │
│ ⚠️  需人工审查项目:                                          │
│ • GUID_234: 夹层空间 - 功能不明确                           │
│ • GUID_567: 设备平台 - 围护结构判断困难                     │
│ • GUID_890: 地下空间 - 层高边界值                           │
│                                                             │
│              [查看详细报告] [审查问题项] [继续计算]           │
└─────────────────────────────────────────────────────────────┘
```

### 阶段4：Agent 3 - 建筑面积计算

#### 用户界面显示：
```
┌─────────────────────────────────────────────────────────────┐
│                建筑面积智能计算系统                           │
├─────────────────────────────────────────────────────────────┤
│ 🏗️  建筑面积计算中...                                        │
│                                                             │
│ 🤖 建筑面积计算代理 正在工作                                 │
│                                                             │
│ ✓ 楼层分类完成                                    [████████] │
│ ✓ 面积计算中...                                  [██████  ] │
│ ⏳ 开洞扣减处理...                                [████    ] │
│ ⏳ 生成计算报告...                                [██      ] │
│                                                             │
│ 📊 计算进度:                                                │
│ • 已处理楼层: 12 / 15                                       │
│ • 已计算楼板: 156 / 203                                     │
│ • 已处理开洞: 89 / 127                                      │
│                                                             │
│ 📝 计算日志:                                                │
│ [14:27:15] 1F层高3.2m -> 系数1.0, 面积1,234.56㎡            │
│ [14:27:18] 地下1层高2.8m -> 系数1.0, 面积987.34㎡            │
│ [14:27:21] 设备层高1.8m -> 系数0.5, 面积156.78㎡             │
│ [14:27:24] 扣减电梯井开洞面积: 12.45㎡                       │
└─────────────────────────────────────────────────────────────┘
```

### 阶段5：最终结果展示

#### 用户界面显示：
```
┌─────────────────────────────────────────────────────────────┐
│                🎉 建筑面积计算完成                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 📊 计算结果汇总                                              │
│                                                             │
│ 🏢 总建筑面积: 15,678.92 ㎡                                  │
│                                                             │
│ 📋 分层明细:                                                │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 楼层    │ 层高(m) │ 系数 │ 楼板面积(㎡) │ 计入面积(㎡) │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ 15F     │  3.0    │ 1.0  │   1,234.56   │  1,234.56   │ │
│ │ 14F     │  3.0    │ 1.0  │   1,234.56   │  1,234.56   │ │
│ │ ...     │  ...    │ ...  │     ...      │    ...      │ │
│ │ 1F      │  3.2    │ 1.0  │   1,456.78   │  1,456.78   │ │
│ │ 地下1F   │  2.8    │ 1.0  │    987.34    │   987.34    │ │
│ │ 设备层   │  1.8    │ 0.5  │    313.56    │   156.78    │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ⚠️  注意事项:                                                │
│ • 71个元素需人工确认，可能影响最终面积±2.3%                  │
│ • 建议复核设备层和夹层的功能定义                             │
│                                                             │
│ 📄 报告选项:                                                │
│ [下载详细报告] [导出Excel] [生成PDF] [查看3D标注]            │
│                                                             │
│ 🔄 后续操作:                                                │
│ [人工审查] [重新计算] [保存项目] [新建项目]                   │
└─────────────────────────────────────────────────────────────┘
```

## 用户可见的关键信息

### 1. 实时进度信息
- 每个Agent的处理进度百分比
- 预计剩余时间
- 当前处理的具体任务

### 2. 中间结果预览
- 法规分析的关键规则提取
- 语义对齐的置信度分布
- 需要人工审查的问题项目

### 3. 质量控制信息
- 置信度等级统计
- 异常情况警告
- 建议的人工干预点

### 4. 最终计算结果
- 总建筑面积数值
- 分层详细计算明细
- 计算依据和系数说明

### 5. 可操作选项
- 结果导出（多种格式）
- 人工审查界面
- 参数调整和重新计算
- 3D可视化标注

## 用户交互要点

1. **透明度**: 用户可以看到每个Agent的工作过程和中间结果
2. **可控性**: 在关键节点提供人工干预选项
3. **可追溯**: 完整的计算依据和推理路径
4. **可验证**: 提供多种格式的详细报告
5. **可调整**: 支持参数修改和重新计算

这种设计确保了用户对整个计算过程有充分的了解和控制，同时保持了操作的简便性。